<html><head><meta charset="utf-8"><title>&lt;b&gt;Spring MVC thread safe distilled&lt;/b&gt;&lt;br&gt;&lt;br&gt;I come across this question wh...</title><style>body {font: 11pt Roboto, Arial, sans-serif; max-width: 640px; margin: 24px;}.author-photo {border-radius: 50%; margin-right: 10px; width: 40px;}.author {font-weight: 500;}.main-content {margin: 15px 0 15px;}.post-title {font-weight: bold;}.location {display: block; margin-top: 15px;}.location img {float: left; margin-right: 5px; width: 20px;}.media-link {display: inline-block; max-width: 100%; vertical-align: top;}.media-link p {margin-top: 5px; max-height: 4em; overflow: scroll;}.media {max-height: 100vh; max-width: 100%;}.video-placeholder {background: black; display: flex; height: 300px; max-width: 100%; width: 640px;}.play-icon {border-bottom: 30px solid transparent; border-left: 50px solid white; border-top: 30px solid transparent; color: white; margin: auto;}.album {max-height: 800px; overflow: scroll; width: calc(100vw - 48px);}.album .media-link {margin-right: 5px; max-width: 250px;}.album .media {max-height: 250px;}.link-embed {border-top: 1px solid lightgrey; display: block; margin-top: 20px;}.link-embed img {max-width: 100%;}.inline-link-embed {display: block;}.inline-link-embed img {vertical-align: middle;}.link-title {display: inline-block; font-size: medium; font-weight: 300; padding-left: 1em;}.reshare-attribution {display: block; font-weight: bold; margin-bottom: 10px;}.poll-image {margin-bottom: 5px; max-height: 300px; max-width: 500px;}.poll-choice {align-items: center; display: flex; margin-bottom: 5px; max-width: 500px;}.poll-choice-percentage {background-color: lightblue; height: 100%; left: 0; position: absolute; z-index: -1;}.poll-choice-selected {margin-right: 5px;}.poll-choice-results {border: 1px solid lightgray; border-radius: 5px; display: flex; line-height: 40px; overflow: hidden; padding: 0 8px; position: relative;}.poll-choice-results, .poll-choice-description {flex-grow: 1; margin-right: 10px;}.poll-choice-image {width: 100%;}.poll-choice-image, .poll-choice-image img {max-height: 40px; max-width: 100px;}.poll-choice-votes {max-height: 100px; overflow: auto;}.plus-entity-embed {color: black; display: block; text-decoration: none;}.plus-entity-embed-cover-photo {max-height: 300px; max-width: 100%;}.plus-entity-embed-info {padding: 0 1em 1em;}.plus-entity-embed-info h2 {font-weight: 500; margin: 10px 0;}.plus-entity-embed-info p {font-size: small; margin: 0;}.collection-owner-avatar {border-radius: 50%; border: 2px solid white; height: 40px; margin-top: -22px;}.visibility {padding: 1em 0; border-top: 1px solid grey;}.post-activity {padding: 1em 0; border-top: 1px solid grey;}.post-kind-desc {margin-bottom: 15pt;}.comments {border-top: 1px solid gray; padding-top: 1em;}.comment + .comment {margin-top: 1em;}.comment .media-link, .comment .inline-link-embed {margin-top: 5px;}</style></head><body><div style="margin-bottom:1em;"><div style="display:flex; align-items:center"><img class="author-photo" src="https://lh3.googleusercontent.com/a-/AAuE7mAHc8Q5zJdeGZWjiL8JA6rqJEgUOHOyB2a-v_iD_w=s64-c" alt="Terrence Miao"><a href="https://plus.google.com/+TerrenceMiao" target="_blank" class="author">Terrence Miao</a> - <a target="_blank" href="https://plus.google.com/+TerrenceMiao/posts/fvbVuMAvaPW">2012-10-26 23:15:28+1100</a><span> - Updated: 2012-10-27 15:29:56+1100</span></div><div class="main-content"><b>Spring MVC thread safe distilled</b><br><br>I come across this question when a controller in Spring MVC which scope is <b>Singleton, is it thread safe?</b><br><br>The answer is NO.<br><br>According to java concurrency thread safety is that the shared data, like instance variables and can be modified, then the Singleton Spring MVC controller has the instance variables, or injected autowired Spring bean isn&#39;t 100% thread safe. But when member variables, inside the method body, then they are thread safe and no need for synchronised.<br><br>Now come along some goodies of the best practice of playing thread safety in Spring by following these simple rules:<br><br><b>1. Don’t use states on Controllers, Service Layer Objects and DAOs</b><br><b>2. If you can’t avoid, first rethink your design, unless you have to use synchronized</b><br><b>3. If you want to use prototype scoped beans, be aware of instance explosion</b></div></div><div class="visibility">Shared with: Public, <a href="https://plus.google.com/112201754385215382872">Terrence Miao</a>, <a href="https://plus.google.com/108100508440823014305">Oleg Kiorsak</a>, <a href="https://plus.google.com/103428354485877420656">Kieran Simpson</a>, <a href="https://plus.google.com/104947156656943348622">James Gemmell</a></div><div class="post-activity"><div class="plus-oners">+1'd by: <a href="https://plus.google.com/104947156656943348622">James Gemmell</a></div></div><div class="comments"><div class="comment"><a target="_blank" href="https://plus.google.com/+DeanBudd" class="author">Dean Budd</a><span class="time"> - 2012-10-27 14:29:42+1100</span><div class="comment-content">Agreed. I&#39;d be highly suspicious if you had state in your controllers and would agree something is wrong with the design i.e Misplaced Responsibility?</div></div><div class="comment"><a target="_blank" href="https://plus.google.com/103428354485877420656" class="author">Kieran Simpson</a><span class="time"> - 2012-10-27 16:51:43+1100</span><div class="comment-content">This is one of the many reasons I&#39;m encouraging my team to &#39;code for immutability&#39;. By declaring variables to be final <b>first</b> you&#39;re protecting against the reference value being changed, and thus improving the thread safety of your beans.</div></div><div class="comment"><a target="_blank" href="https://plus.google.com/+OlegKiorsak" class="author">Oleg Kiorsak</a><span class="time"> - 2012-10-27 18:56:25+1100</span><div class="comment-content">one very widespread idiotic &quot;practice&quot; is &quot;diligently&quot; adding getters and setters (!!) where there is absolutely no need for them (especailly for the setter)...  <br>also externally exposing lists, maps, etc (again via getters ;)...<br>all of this makes for inherently thread UN-safe code...</div></div><div class="comment"><a target="_blank" href="https://plus.google.com/+TerrenceMiao" class="author">Terrence Miao</a><span class="time"> - 2012-10-27 20:22:22+1100</span><div class="comment-content"><span class="proflinkWrapper"><span class="proflinkPrefix">+</span><a class="proflink bidi_isolate" href="https://plus.google.com/108100508440823014305" oid="108100508440823014305" >Oleg Kiorsak</a></span> One thing I don&#39;t like Java POJO in Action is the spreading of poison of Getters and Setters. In most case, they have default behaviour and shouldn&#39;t specify explicitly. So that&#39;s why I like MetaClass interface within Groovy could defines the behaviour POJO like for Groovy or Java class.<br><br>Less is more.<br><br>Less code is always clean, better and reliable code. Less code reflects clean design and simple approach to solve the complicated problem.</div></div><div class="comment"><a target="_blank" href="https://plus.google.com/103428354485877420656" class="author">Kieran Simpson</a><span class="time"> - 2012-10-27 20:24:55+1100</span><div class="comment-content">If you have so many getters and setters <span class="proflinkWrapper"><span class="proflinkPrefix">+</span><a class="proflink bidi_isolate" href="https://plus.google.com/112201754385215382872" oid="112201754385215382872" >Terrence Miao</a></span> I would ask whether you have a data structure (or Value Type) and thus why not make all the fields public and get rid of the getters and setters?</div></div><div class="comment"><a target="_blank" href="https://plus.google.com/+OlegKiorsak" class="author">Oleg Kiorsak</a><span class="time"> - 2012-10-27 20:39:08+1100</span><div class="comment-content">on top of having at least some level of awareness regarding concurrent and thread safety, I think that tools like FindBugz are you friends too...</div></div><div class="comment"><a target="_blank" href="https://plus.google.com/+TerrenceMiao" class="author">Terrence Miao</a><span class="time"> - 2012-10-27 22:06:57+1100</span><div class="comment-content"><span class="proflinkWrapper"><span class="proflinkPrefix">+</span><a class="proflink bidi_isolate" href="https://plus.google.com/103428354485877420656" oid="103428354485877420656" >Kieran Simpson</a></span> I think the common practice is that POJO must be accessible using get, set, following a standard naming convention. <b>This allows easy automated inspection and updating of bean state within frameworks.</b><br><br>We have data structure but that wouldn&#39;t prevent integration architect defined an object in integration layer with hundreds properties. We have the transformer classes which one class could over 1000 lines code threshold just do data mapping. Ironically, IDE automatically generates getters and setters developers have to manually write unit test on getters and setters.<br><br>Is this a design issue? I think so ...</div></div><div class="comment"><a target="_blank" href="https://plus.google.com/104947156656943348622" class="author">James Gemmell</a><span class="time"> - 2012-10-28 15:34:03+1100</span><div class="comment-content">Try <a rel="nofollow" target="_blank" href="http://code.google.com/p/bean-matchers/" class="ot-anchor bidi_isolate" jslog="10929; track:click" dir="ltr">http://code.google.com/p/bean-matchers/</a> (as suggested by <span class="proflinkWrapper"><span class="proflinkPrefix">+</span><a class="proflink bidi_isolate" href="https://plus.google.com/103428354485877420656" oid="103428354485877420656" >Kieran Simpson</a></span>) or <a rel="nofollow" target="_blank" href="http://code.google.com/p/openpojo/" class="ot-anchor bidi_isolate" jslog="10929; track:click" dir="ltr">http://code.google.com/p/openpojo/</a> for automating your POJO tests.<br><br>The subject of when to use getters and setters came up in one of our <i>Friday Java</i> questions. In a IoC assembled world, Service Layer Objects, Controllers and DAOs only require setters - IMHO having getters only encourages gratuitous violations of the <i>Law of Demeter</i>. DTOs, value objects, entities and the like obviously need getters. Unless required by the framework, setters can be dispensed with in favour of constructor args.</div></div><div class="comment"><a target="_blank" href="https://plus.google.com/103428354485877420656" class="author">Kieran Simpson</a><span class="time"> - 2012-10-28 21:06:11+1100</span><span> - Updated: 2012-10-28 21:06:35+1100</span><div class="comment-content">IMHO <span class="proflinkWrapper"><span class="proflinkPrefix">+</span><a class="proflink bidi_isolate" href="https://plus.google.com/104947156656943348622" oid="104947156656943348622" >James Gemmell</a></span> if you&#39;re having your value objects being immutable I think it&#39;s better that all the fields are public final with associated Builders if construction requires multiple steps/sources.  Methods imply behaviour where what you really have is dumb data structures (with a few helper methods thrown in if needed ie: equals or toString)  It also prevents source file bloat as your average getter (especially if it&#39;s autogenerated by ones IDE) is ~3 LOC.  Since going that way myself I&#39;ve been reading value objects, DTOs, etc in a new way and have successfully resisted the urge to place behaviour into them that really belongs somewhere else.  If it walks too much like <del>a duck</del> an entity, people want to make it one.<br><br>Just my 1c :)</div></div><div class="comment"><a target="_blank" href="https://plus.google.com/+TerrenceMiao" class="author">Terrence Miao</a><span class="time"> - 2012-10-28 23:40:55+1100</span><div class="comment-content"><span class="proflinkWrapper"><span class="proflinkPrefix">+</span><a class="proflink bidi_isolate" href="https://plus.google.com/104947156656943348622" oid="104947156656943348622" >James Gemmell</a></span> Will give a bean matcher try later. Cheers.</div></div></div></body></html>